<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

  <!-- ===== OpenGraph (–ø–æ–¥ GitHub Pages –ª—É—á—à–µ —É–∫–∞–∑–∞—Ç—å –ø–æ–ª–Ω—ã–π URL) ===== -->
  <meta property="og:title" content="–ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –Ω–∞ –Æ–±–∏–ª–µ–π" />
  <meta property="og:description" content="18 —è–Ω–≤–∞—Ä—è. –ë—É–¥–µ–º –æ—á–µ–Ω—å –∂–¥–∞—Ç—å!" />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="photo.jpg" />
  <meta property="og:url" content="https://example.com/invite" />

  <meta name="theme-color" content="#2b1331" />
  <title>–ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,600;1,400&family=Great+Vibes&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg-gradient: radial-gradient(circle at center, #2b1331, #0f0c29);
      --paper: #fcf5e5;
      --paper-back: #f0e6d2;

      --gold: #c5a059;
      --gold-2: #fcf6ba;
      --gold-shine: linear-gradient(45deg, #bf953f, #fcf6ba, #b38728, #fbf5b7);

      --red: #8a1c1c;

      --shadow: 0 14px 40px rgba(0,0,0,.38);
      --shadow-soft: 0 8px 22px rgba(0,0,0,0.25);
      --radius: 16px;

      --flip-duration: 1.06s;
      --flip-ease: cubic-bezier(0.64, 0.04, 0.32, 1);

      --safe-bottom: env(safe-area-inset-bottom, 0px);
    }

    *{ box-sizing: border-box; }
    html, body{ height: 100%; }

    body{
      margin: 0;
      background: var(--bg-gradient);
      display: flex;
      justify-content: center;
      align-items: center;
      font-family: 'Cormorant Garamond', serif;
      overflow: hidden;
      perspective: 2600px;
      min-height: 100dvh;
      height: 100dvh;
      touch-action: pan-y;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    body::before{
      content:""; position: fixed; inset: 0; pointer-events:none;
      background:
        radial-gradient(circle at 20% 30%, rgba(197,160,89,.10), transparent 46%),
        radial-gradient(circle at 84% 68%, rgba(252,246,186,.08), transparent 48%),
        radial-gradient(circle at 50% 105%, rgba(255,255,255,.06), transparent 55%);
      opacity: .95;
      filter: blur(2px);
    }

    #fx{
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
    }

    .music-btn{
      position: fixed;
      top: 18px; right: 18px;
      width: 44px; height: 44px;
      border-radius: 50%;
      border: 1px solid rgba(197,160,89,.9);
      color: var(--gold);
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      z-index: 500;
      backdrop-filter: blur(7px);
      -webkit-backdrop-filter: blur(7px);
      background: rgba(20, 10, 30, .20);
      transition: transform .18s ease, box-shadow .18s ease, opacity .18s ease;
      opacity: .95;
      -webkit-tap-highlight-color: transparent;
      user-select: none;
    }
    .music-btn:hover{ transform: scale(1.08); }
    .music-btn.is-playing{
      box-shadow: 0 0 18px rgba(197,160,89,.38);
      animation: pulseMusic 2.2s infinite;
    }
    @keyframes pulseMusic{
      0% { box-shadow: 0 0 0 0 rgba(197,160,89, 0.40); }
      70% { box-shadow: 0 0 0 12px rgba(197,160,89, 0.00); }
      100% { box-shadow: 0 0 0 0 rgba(197,160,89, 0.00); }
    }

    .book{
      width: 90vw;
      max-width: 455px;
      height: min(650px, 86dvh);
      position: relative;
      transform-style: preserve-3d;
      z-index: 30;
      filter: drop-shadow(var(--shadow));
      transform: rotateY(-8deg) rotateX(1.5deg);
      transition: transform 0.45s ease;
      will-change: transform;
    }

    body.opened .book{
      transform: rotateY(-6deg) rotateX(1.2deg);
    }
    body.back-closed .book{
      transform: rotateY(6deg) rotateX(1.1deg);
    }

    .book::before{
      content:"";
      position: absolute;
      inset: -20px;
      border-radius: 28px;
      background:
        radial-gradient(circle at 15% 30%, rgba(252,246,186,.10), transparent 55%),
        radial-gradient(circle at 85% 70%, rgba(197,160,89,.10), transparent 60%),
        radial-gradient(circle at 50% 50%, rgba(255,255,255,.05), transparent 65%);
      filter: blur(10px);
      opacity: .95;
      z-index: -1;
      animation: aura 6s ease-in-out infinite;
      pointer-events:none;
    }
    @keyframes aura{
      0%,100%{ transform: translateY(0px) scale(1); opacity:.85; }
      50%{ transform: translateY(-6px) scale(1.02); opacity:1; }
    }

    .book::after{
      content:"";
      position:absolute;
      top: 10px;
      bottom: 10px;
      right: -12px;
      width: 18px;
      border-radius: 0 18px 18px 0;
      background:
        linear-gradient(to right, rgba(255,255,255,.18), rgba(0,0,0,.12)),
        repeating-linear-gradient(
          to bottom,
          rgba(0,0,0,.08) 0px,
          rgba(0,0,0,.08) 1px,
          rgba(255,255,255,.0) 3px,
          rgba(255,255,255,.0) 6px
        );
      opacity: .55;
      pointer-events:none;
      transform: translateZ(-1px);
      filter: blur(.2px);
      transition: opacity .35s ease;
    }
    body.back-closed .book::after{ opacity: .28; }

    .backCover{
      position:absolute;
      inset:0;
      border-radius: 4px var(--radius) var(--radius) 4px;
      background: #2b1331;
      border: 4px double var(--gold);
      box-shadow: var(--shadow-soft);
      z-index: 1000;
      opacity: 0;
      pointer-events: none;
      transform: translateZ(2px) scale(0.985);
      transition: opacity .55s ease, transform .55s ease;
      display:flex;
      flex-direction:column;
      justify-content:center;
      align-items:center;
      text-align:center;
      padding: 30px 20px calc(30px + var(--safe-bottom));
      overflow:hidden;
    }
    .backCover::before{
      content:"";
      position:absolute;
      inset:-40%;
      background:
        radial-gradient(circle at 50% 50%, rgba(197,160,89,.10), transparent 58%),
        linear-gradient(120deg,
          rgba(255,255,255,0) 35%,
          rgba(252,246,186,.20) 48%,
          rgba(255,255,255,0) 62%);
      transform: translateX(-90%) rotate(10deg);
      opacity: .55;
      mix-blend-mode: screen;
      animation: coverShimmer 7s ease-in-out infinite;
      pointer-events:none;
    }
    @keyframes coverShimmer{
      0%, 20% { transform: translateX(-95%) rotate(10deg); opacity: 0; }
      35%{ opacity: .7; }
      55% { transform: translateX(95%) rotate(10deg); opacity: 0; }
      100%{ transform: translateX(95%) rotate(10deg); opacity: 0; }
    }
    body.back-closed .backCover{
      opacity: 1;
      pointer-events: auto;
      transform: translateZ(2px) scale(1);
    }

    .page{
      width: 100%;
      height: 100%;
      position: absolute;
      inset: 0;

      transform-origin: left center;
      transform-style: preserve-3d;

      border-radius: 4px var(--radius) var(--radius) 4px;
      box-shadow: var(--shadow-soft);

      transition: transform var(--flip-duration) var(--flip-ease);
      pointer-events: none;
      will-change: transform;

      -webkit-transform-style: preserve-3d;
      -webkit-backface-visibility: hidden;
      transform: translateZ(0.1px);
    }
    .page.active-page{ pointer-events: auto; }

    .page.flipped{
      transform: rotateY(-179.7deg) translateX(-2px) translateZ(0.1px);
      pointer-events: none;
    }
    .page.cover.flipped{
      transform: rotateY(-165deg) translateX(-8px) translateZ(0.1px);
    }
    .page.turning{
      filter: drop-shadow(0 22px 28px rgba(0,0,0,.33));
    }

    .front, .back{
      position: absolute;
      inset: 0;
      backface-visibility: hidden;
      -webkit-backface-visibility: hidden;

      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;

      padding: 30px 22px calc(30px + var(--safe-bottom));
      text-align: center;

      border: 1px solid #e0d0b0;
      border-radius: 4px var(--radius) var(--radius) 4px;

      background-color: var(--paper);
      background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100' height='100' filter='url(%23noise)' opacity='0.08'/%3E%3C/svg%3E");
      transform: translateZ(0.2px);
    }

    .back{
      transform: rotateY(180deg) translateZ(0.2px);
      background-color: var(--paper-back);
      background-image: repeating-linear-gradient(45deg,
        rgba(197,160,89,0.10) 0, rgba(197,160,89,0.10) 10px,
        transparent 10px, transparent 22px
      );
    }

    .front::after{
      content:"";
      position:absolute;
      top: 0; bottom: 0;
      right: 0;
      width: 16px;
      border-radius: 0 var(--radius) var(--radius) 0;
      background: linear-gradient(90deg,
        rgba(197,160,89,0.00),
        rgba(197,160,89,0.22),
        rgba(252,246,186,0.40),
        rgba(255,255,255,0.25),
        rgba(197,160,89,0.08)
      );
      opacity: .55;
      pointer-events:none;
      mix-blend-mode: screen;
    }

    .page.turning .front::before{
      content:"";
      position:absolute;
      top:-10%;
      bottom:-10%;
      right:-40px;
      width: 110px;
      background: radial-gradient(circle at 40% 50%,
        rgba(255,255,255,.30),
        rgba(252,246,186,.14),
        rgba(197,160,89,0.0) 65%);
      filter: blur(6px);
      opacity: 0;
      transform: translateX(0);
      pointer-events:none;
      animation: edgeGlint 0.95s ease-out forwards;
    }
    @keyframes edgeGlint{
      0%{ opacity: 0; transform: translateX(-10px); }
      35%{ opacity: .82; }
      100%{ opacity: 0; transform: translateX(30px); }
    }

    h1, h2{
      font-family: 'Great Vibes', cursive;
      margin: 6px 0;
      line-height: 1.1;
      letter-spacing: .2px;
    }
    h1{
      font-size: 3.45rem;
      background: var(--gold-shine);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    h2{
      font-size: 2.18rem;
      color: var(--red);
      margin-top: 14px;
    }
    p{
      font-size: 1.10rem;
      color: #2f2f2f;
      margin: 8px 0;
      line-height: 1.52;
    }
    .muted{ font-size: .95rem; color: #6e6e6e; }

    .icon-lg{
      font-size: 2.55rem;
      margin-bottom: 8px;
      filter: drop-shadow(0 4px 2px rgba(0,0,0,0.1));
    }

    .content-box{
      width: 100%;
      opacity: 0;
      transform: translateY(14px);
      transition: opacity .78s ease, transform .78s ease;
      pointer-events: none;
    }
    .page.active-page .content-box,
    .page.preactive .content-box{
      opacity: 1;
      transform: translateY(0);
      pointer-events: auto;
      transition-delay: .22s;
    }

    .nav-container{
      width: 100%;
      margin-top: auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 8px;
      height: 54px;
    }

    .btn-nav{
      background: none;
      border: none;
      font-family: 'Great Vibes', cursive;
      font-size: 1.85rem;
      color: var(--red);
      cursor: pointer;
      padding: 6px 14px;
      opacity: .90;
      transition: transform .18s ease, color .18s ease, opacity .18s ease;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
    }
    .btn-nav:hover{ transform: scale(1.1); color: var(--gold); opacity: 1; }
    .rot180{ transform: rotate(180deg); }
    .rot180:hover{ transform: rotate(180deg) scale(1.1); }

    .countdown{
      width: 100%;
      margin: 10px auto 6px;
      padding: 10px;
      border-radius: 14px;
      border: 1px solid rgba(197,160,89,.35);
      background: rgba(255,255,255,0.45);
      backdrop-filter: blur(4px);
      -webkit-backdrop-filter: blur(4px);
    }
    .countdown-grid{
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 6px;
    }
    .cd-item{
      background: rgba(252,246,186,.22);
      border-radius: 10px;
      padding: 6px 5px;
      border: 1px solid rgba(197,160,89,.18);
    }
    .cd-num{ font-weight: 700; font-size: 1.22rem; color: #222; }
    .cd-lbl{ font-size: 0.82rem; color: #666; }

    /* ===== –°–ö–ï–¢–ß–ò ===== */
    .sketch{
      width: 270px;
      margin: 8px auto 2px;
      opacity: .92;
      filter: drop-shadow(0 10px 10px rgba(0,0,0,0.08));
    }
    .sketch path{
      fill: none;
      stroke: rgba(138,28,28,.92);
      stroke-width: 2.1;
      stroke-linecap: round;
      stroke-linejoin: round;
      stroke-dasharray: 800;
      stroke-dashoffset: 800;
      opacity: 0;
    }
    .page.active-page .sketch path{
      animation: drawLine 1.7s ease forwards;
    }
    @keyframes drawLine{
      0%{ stroke-dashoffset: 800; opacity: 0; }
      12%{ opacity: 1; }
      100%{ stroke-dashoffset: 0; opacity: 1; }
    }

    /* ===== TYPEWRITER: –∫—É—Ä—Å–æ—Ä –±–µ–∑ –≤–ª–∏—è–Ω–∏—è –Ω–∞ –ø–µ—Ä–µ–Ω–æ—Å—ã ===== */
    [data-typewriter]{
      border-right: 1px solid rgba(138,28,28,0);
      padding-right: 4px;
    }
    .tw{
      animation: caret 1.1s steps(1) infinite;
    }
    @keyframes caret{
      0%,45%{ border-right-color: rgba(138,28,28,0); }
      46%,100%{ border-right-color: rgba(138,28,28,.55); }
    }

    /* ===== ‚Äú–ë–µ–ª–∞—è –ø–æ–¥–ª–æ–∂–∫–∞‚Äù –¥–ª—è –ø–µ—á–∞—Ç–∞—é—â–µ–≥–æ—Å—è —Ç–µ–∫—Å—Ç–∞ + fade-in ===== */
    .tw-card{
      margin: 12px auto 0;
      padding: 12px 14px;
      border-radius: 14px;
      border: 1px solid rgba(197,160,89,.30);
      background: rgba(255,255,255,0.55);
      text-align: left;

      opacity: 0;
      transform: translateY(6px);
      transition: opacity .55s ease, transform .55s ease;
    }
    .tw-card.is-visible{
      opacity: 1;
      transform: translateY(0);
    }

    /* ===== –¢–∞–π–º–ª–∞–π–Ω ===== */
    .timeline{
      width: 100%;
      text-align: left;
      margin: 12px 0 6px;
      padding: 0 4px 0 10px;
    }
    .tl-item{
      display: grid;
      grid-template-columns: 74px 1fr;
      gap: 10px;
      align-items: start;
      padding: 8px 0;
      position: relative;
    }
    .tl-year{
      font-weight: 700;
      color: #2b1331;
      letter-spacing: .5px;
    }
    .tl-text{ color:#2f2f2f; }
    .tl-item::before{
      content:"";
      position:absolute;
      left: 62px;
      top: 0;
      bottom: 0;
      width: 1px;
      background: rgba(197,160,89,.35);
    }
    .tl-dot{
      position: absolute;
      left: 57px;
      top: 15px;
      width: 11px;
      height: 11px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, rgba(252,246,186,.95), rgba(197,160,89,.9));
      box-shadow: 0 0 12px rgba(197,160,89,.25);
    }

    .list-elegant{
      width: 100%;
      text-align: left;
      margin: 10px 0 0;
      padding: 0 6px 0 18px;
    }
    .list-elegant li{
      margin: 7px 0;
      color: #2f2f2f;
    }

    /* ===== –ì–ê–õ–ï–†–ï–Ø ===== */
    .gallery{
      display: flex;
      gap: 10px;
      overflow-x: auto;
      padding: 10px 6px 12px;
      scrollbar-width: none;
      -webkit-overflow-scrolling: touch;
      touch-action: pan-x;
      scroll-snap-type: x mandatory;
      overscroll-behavior-x: contain;
      user-select: none;
      cursor: grab;
    }
    .gallery:active{ cursor: grabbing; }
    .gallery::-webkit-scrollbar{ display: none; }

    .polaroid{
      flex: 0 0 auto;
      width: 176px;
      background: white;
      padding: 8px 8px 18px 8px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.22);
      border-radius: 8px;
      transform: rotate(-1.6deg);
      scroll-snap-align: start;
    }
    .polaroid:nth-child(2){ transform: rotate(1.1deg); }
    .polaroid:nth-child(3){ transform: rotate(-0.8deg); }
    .polaroid:nth-child(4){ transform: rotate(0.6deg); }

    .polaroid img{
      width: 100%;
      height: 160px;
      object-fit: cover;
      border-radius: 6px;
      border: 1px solid #eee;
      display:block;
      pointer-events: none;
    }
    .photo-caption{
      margin-top: 8px;
      font-size: .92rem;
      color: #4a4a4a;
      line-height: 1.25;
      padding: 0 2px;
    }

    input, select, .submit-btn, .map-btn, .tg-btn{
      width: 100%;
      padding: 10px;
      margin: 8px 0;
      background: transparent;
      border: none;
      border-bottom: 2px solid var(--gold);
      font-family: 'Cormorant Garamond', serif;
      font-size: 1.1rem;
      outline: none;
    }

    .submit-btn, .map-btn, .tg-btn{
      border-bottom: none;
      color: #fcf6ba;
      border: 1px solid var(--gold);
      border-radius: 22px;
      cursor: pointer;
      margin-top: 10px;
      text-decoration: none;
      display: inline-block;
      box-shadow: 0 6px 16px rgba(0,0,0,0.22);
      background: var(--bg-gradient);
      transition: transform .18s ease, opacity .18s ease, background .18s ease;
      -webkit-tap-highlight-color: transparent;
    }
    .submit-btn:hover, .map-btn:hover, .tg-btn:hover{ transform: translateY(-1px); }

    .map-btn{ background: #8a1c1c; }
    .tg-btn{
      background: linear-gradient(180deg, rgba(0, 136, 204, .95), rgba(0, 106, 160, .95));
      border-color: rgba(200, 230, 255, .45);
    }

    /* –û–±–ª–æ–∂–∫–∞ */
    #p1 .front{
      background: #2b1331;
      border: 4px double var(--gold);
      justify-content: center;
    }
    #p1 .back{
      background:
        radial-gradient(circle at 50% 40%, rgba(252,246,186,.10), transparent 55%),
        repeating-linear-gradient(45deg, rgba(197,160,89,0.10) 0, rgba(197,160,89,0.10) 10px, transparent 10px, transparent 22px);
      border: 2px solid rgba(197,160,89,.35);
    }

    .cover-runes{
      width: 100%;
      opacity: .9;
      margin: 10px 0 6px;
      filter: drop-shadow(0 6px 10px rgba(0,0,0,0.25));
    }

    @media (prefers-reduced-motion: reduce){
      .page, .content-box, .book, .book::before, .backCover::before{ transition: none !important; animation: none !important; }
      .page.turning .front::before{ display:none !important; }
      .sketch path{ animation: none !important; opacity: 1 !important; stroke-dashoffset: 0 !important; }
      .tw{ animation: none !important; border-right-color: rgba(138,28,28,0) !important; }
      .tw-card{ opacity: 1 !important; transform: none !important; transition: none !important; }
      .gallery{ scroll-snap-type: none !important; }
    }
  </style>
</head>

<body>
  <button class="music-btn" id="musicBtn" type="button" aria-label="Music">üéµ</button>

  <audio id="bg-music" loop preload="auto">
    <source src="Music.mp3" type="audio/mpeg">
  </audio>

  <canvas id="fx"></canvas>

  <div class="book" id="book">
    <div class="backCover" id="backCover">
      <svg class="cover-runes" viewBox="0 0 600 90" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" style="margin-bottom:10px;">
        <defs>
          <linearGradient id="g2" x1="0" x2="1">
            <stop offset="0" stop-color="#bf953f" stop-opacity=".9"/>
            <stop offset=".5" stop-color="#fcf6ba" stop-opacity=".95"/>
            <stop offset="1" stop-color="#b38728" stop-opacity=".9"/>
          </linearGradient>
        </defs>
        <path d="M40,45 C120,80 200,80 300,45 C400,10 480,10 560,45"
              fill="none" stroke="url(#g2)" stroke-width="3" stroke-linecap="round" opacity=".9"/>
        <circle cx="300" cy="45" r="10" fill="none" stroke="url(#g2)" stroke-width="3" opacity=".9"/>
        <path d="M292,45 L308,45 M300,37 L300,53" stroke="url(#g2)" stroke-width="3" opacity=".9"/>
      </svg>

      <h1>–î–æ –≤—Å—Ç—Ä–µ—á–∏!</h1>
      <p style="color:#d7d7d7; margin-top:4px;" id="backCoverText">–ë—É–¥–µ–º –æ—á–µ–Ω—å –∂–¥–∞—Ç—å</p>

      <div class="nav-container" style="justify-content:center; margin-top:24px;">
        <button class="btn-nav rot180" id="restartBtn" aria-label="–ù–∞–∑–∞–¥">&#10140;</button>
      </div>
    </div>

    <!-- PAGE 1: –æ–±–ª–æ–∂–∫–∞ (–±–µ–∑ –≤–æ–∑—Ä–∞—Å—Ç–∞) -->
    <div class="page cover active-page" id="p1">
      <div class="front">
        <div class="content-box" style="height:100%; display:flex; flex-direction:column; justify-content:center; align-items:center;">
          <div style="color:var(--gold); font-size:1.02rem; letter-spacing:2px;">–ü–†–ò–ì–õ–ê–®–ï–ù–ò–ï</div>

          <svg class="cover-runes" viewBox="0 0 600 90" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
            <defs>
              <linearGradient id="g" x1="0" x2="1">
                <stop offset="0" stop-color="#bf953f" stop-opacity=".9"/>
                <stop offset=".5" stop-color="#fcf6ba" stop-opacity=".95"/>
                <stop offset="1" stop-color="#b38728" stop-opacity=".9"/>
              </linearGradient>
            </defs>
            <path d="M40,45 C120,10 200,10 300,45 C400,80 480,80 560,45"
                  fill="none" stroke="url(#g)" stroke-width="3" stroke-linecap="round" opacity=".9"/>
            <path d="M70,45 L110,45 M490,45 L530,45" stroke="url(#g)" stroke-width="3" opacity=".7"/>
            <circle cx="300" cy="45" r="10" fill="none" stroke="url(#g)" stroke-width="3" opacity=".9"/>
            <path d="M292,45 L308,45 M300,37 L300,53" stroke="url(#g)" stroke-width="3" opacity=".9"/>
          </svg>

          <h1 id="heroName">–ò–º—è<br>–ò–º–µ–Ω–∏–Ω–Ω–∏—Ü—ã</h1>
          <p style="color:#d7d7d7; margin:10px 0 0;">–¢—ë–ø–ª—ã–π —Å–µ–º–µ–π–Ω—ã–π –≤–µ—á–µ—Ä</p>
          <p style="color:#d7d7d7; margin-top:6px;" id="heroDate">18 —è–Ω–≤–∞—Ä—è</p>

          <div class="nav-container" style="justify-content:center; margin-top:26px;">
            <button class="btn-nav" id="openBtn">–û—Ç–∫—Ä—ã—Ç—å &#10140;</button>
          </div>
        </div>
      </div>
      <div class="back"></div>
    </div>

    <!-- PAGE 2 -->
    <div class="page" id="p2">
      <div class="front">
        <div class="content-box">
          <div class="icon-lg">‚ú¶</div>
          <h2>–° –ª—é–±–æ–≤—å—é</h2>

          <p data-typewriter data-speed="22">
            –°–µ–≥–æ–¥–Ω—è –º—ã –æ—Ç–∫—Ä—ã–≤–∞–µ–º –∫–Ω–∏–≥—É, –≥–¥–µ –∫–∞–∂–¥–∞—è –≥–ª–∞–≤–∞ ‚Äî —Ç—ë–ø–ª–∞—è, —Å–≤–µ—Ç–ª–∞—è –∏ –Ω–∞—Å—Ç–æ—è—â–∞—è.
            –í —ç—Ç–æ—Ç –¥–µ–Ω—å —Ö–æ—á–µ—Ç—Å—è —Å–∫–∞–∑–∞—Ç—å –≥–ª–∞–≤–Ω–æ–µ: –º—ã —Ä—è–¥–æ–º, –∏ –º—ã –æ—á–µ–Ω—å —Ç–µ–±—è –ª—é–±–∏–º.
          </p>
          <p class="muted" style="text-align:right; margin-top:8px;" id="introSign">‚Äî —Ç–≤–æ—è —Å–µ–º—å—è</p>

          <svg class="sketch" viewBox="0 0 300 120" aria-hidden="true">
            <path d="M20,70 C70,20 130,20 180,70 C210,95 245,95 280,70" />
            <path d="M52,74 C85,110 215,110 248,74" />
            <path d="M148,50 C140,38 140,26 150,18 C160,26 160,38 152,50" />
          </svg>

          <div class="nav-container">
            <button class="btn-nav rot180" data-prev>&#10140;</button>
            <button class="btn-nav" data-next>–ì–ª–∞–≤—ã &#10140;</button>
          </div>
        </div>
      </div>
      <div class="back"></div>
    </div>

    <!-- PAGE 3 -->
    <div class="page" id="p3">
      <div class="front">
        <div class="content-box">
          <div class="icon-lg">üìñ</div>
          <h2>–ì–ª–∞–≤—ã –∂–∏–∑–Ω–∏</h2>
          <p class="muted">–ù–µ–±–æ–ª—å—à–∏–µ —à—Ç—Ä–∏—Ö–∏ ‚Äî –æ —Å–∞–º–æ–º –≤–∞–∂–Ω–æ–º.</p>

          <div class="timeline">
            <div class="tl-item">
              <span class="tl-dot"></span>
              <div class="tl-year">–Æ–Ω–æ—Å—Ç—å</div>
              <div class="tl-text">–í—Ä–µ–º—è –º–µ—á—Ç–∞–Ω–∏–π, —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∞ –∏ —Å–º–µ–ª—ã—Ö —Ä–µ—à–µ–Ω–∏–π.</div>
            </div>
            <div class="tl-item">
              <span class="tl-dot"></span>
              <div class="tl-year">–°–µ–º—å—è</div>
              <div class="tl-text">–î–æ–º, –≤ –∫–æ—Ç–æ—Ä–æ–º –≤—Å–µ–≥–¥–∞ —Ç–µ–ø–ª–æ. –ó–∞–±–æ—Ç–∞, –∫–æ—Ç–æ—Ä—É—é –ø–æ–º–Ω—è—Ç.</div>
            </div>
            <div class="tl-item">
              <span class="tl-dot"></span>
              <div class="tl-year">–î–µ–ª–æ</div>
              <div class="tl-text">–¢—Ä—É–¥, –≤ –∫–æ—Ç–æ—Ä–æ–º –µ—Å—Ç—å –¥–æ—Å—Ç–æ–∏–Ω—Å—Ç–≤–æ –∏ —É–≤–∞–∂–µ–Ω–∏–µ –ª—é–¥–µ–π.</div>
            </div>
            <div class="tl-item">
              <span class="tl-dot"></span>
              <div class="tl-year">–°–µ–≥–æ–¥–Ω—è</div>
              <div class="tl-text">–†—è–¥–æ–º —Ç–µ, –∫—Ç–æ –ª—é–±–∏—Ç. –ò –≤–ø–µ—Ä–µ–¥–∏ ‚Äî –µ—â—ë –º–Ω–æ–≥–æ —Å–≤–µ—Ç–∞.</div>
            </div>
          </div>

          <p data-typewriter data-speed="20">
            –ò –∏–º–µ–Ω–Ω–æ –ø–æ—ç—Ç–æ–º—É –º—ã —Ö–æ—Ç–∏–º —Å–æ–±—Ä–∞—Ç—å—Å—è –≤–º–µ—Å—Ç–µ ‚Äî —á—Ç–æ–±—ã –æ—Ç–º–µ—Ç–∏—Ç—å —ç—Ç–æ—Ç –¥–µ–Ω—å –∫—Ä–∞—Å–∏–≤–æ –∏ –ø–æ-–Ω–∞—Å—Ç–æ—è—â–µ–º—É.
          </p>

          <div class="nav-container">
            <button class="btn-nav rot180" data-prev>&#10140;</button>
            <button class="btn-nav" data-next>–¢–µ–ø–ª–æ &#10140;</button>
          </div>
        </div>
      </div>
      <div class="back"></div>
    </div>

    <!-- PAGE 4 (–î–æ–º –∏ —Ç–µ–ø–ª–æ ‚Äî —Ç—É—Ç —Ä–∞–Ω—å—à–µ "–ø—Ä—ã–≥–∞–ª–æ") -->
    <div class="page" id="p4">
      <div class="front">
        <div class="content-box">
          <div class="icon-lg">‚úø</div>
          <h2>–î–æ–º –∏ —Ç–µ–ø–ª–æ</h2>

          <p data-typewriter data-speed="22">
            –¢—ã —É–º–µ–µ—à—å –ø—Ä–µ–≤—Ä–∞—â–∞—Ç—å –æ–±—ã—á–Ω—ã–π –¥–µ–Ω—å –≤ —É—é—Ç ‚Äî –≤–∑–≥–ª—è–¥–æ–º, —Å–ª–æ–≤–æ–º, –∑–∞–±–æ—Ç–æ–π. –≠—Ç–æ —Ä–µ–¥–∫–∏–π –¥–∞—Ä.
          </p>

          <svg class="sketch" viewBox="0 0 300 120" aria-hidden="true">
            <path d="M30,78 C70,40 110,40 150,78 C190,40 230,40 270,78" />
            <path d="M60,80 C95,110 205,110 240,80" />
          </svg>

          <ul class="list-elegant">
            <li>–° —Ç–æ–±–æ–π —Ä—è–¥–æ–º —Å–ø–æ–∫–æ–π–Ω–æ.</li>
            <li>–£ —Ç–µ–±—è –≤—Å–µ–≥–¥–∞ –Ω–∞–π–¥—ë—Ç—Å—è –¥–æ–±—Ä–æ–µ —Å–ª–æ–≤–æ.</li>
            <li>–¢–≤–æ–∏ —Ç—Ä–∞–¥–∏—Ü–∏–∏ ‚Äî –Ω–∞—à–µ –±–æ–≥–∞—Ç—Å—Ç–≤–æ.</li>
          </ul>

          <div class="nav-container">
            <button class="btn-nav rot180" data-prev>&#10140;</button>
            <button class="btn-nav" data-next>–ü—Ä–æ–≥—Ä–∞–º–º–∞ &#10140;</button>
          </div>
        </div>
      </div>
      <div class="back"></div>
    </div>

    <!-- PAGE 5 -->
    <div class="page" id="p5">
      <div class="front">
        <div class="content-box">
          <div class="icon-lg">‚è≥</div>
          <h2>–í–µ—á–µ—Ä</h2>

          <div style="text-align:left; margin:14px 0 8px; padding-left: 10px;">
            <p><strong>16:00</strong> ‚Äî –°–±–æ—Ä –≥–æ—Å—Ç–µ–π</p>
            <p><strong>17:00</strong> ‚Äî –ü—Ä–∞–∑–¥–Ω–∏—á–Ω—ã–π —É–∂–∏–Ω</p>
            <p><strong>19:00</strong> ‚Äî –¢—ë–ø–ª—ã–µ —Å–ª–æ–≤–∞ –∏ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏—è</p>
            <p><strong>21:30</strong> ‚Äî –¢–æ—Ä—Ç</p>
          </div>

          <p class="muted" style="margin-top:6px;"><strong>–î—Ä–µ—Å—Å-–∫–æ–¥:</strong> —ç–ª–µ–≥–∞–Ω—Ç–Ω–∞—è –∫–ª–∞—Å—Å–∏–∫–∞ (–ø–æ –∂–µ–ª–∞–Ω–∏—é ‚Äî –∑–æ–ª–æ—Ç–æ–π –∞–∫—Ü–µ–Ω—Ç)</p>

          <div class="countdown">
            <div style="color:var(--red); font-family:'Great Vibes'; font-size:1.3rem; margin-bottom:6px;">–î–æ –≤–µ—á–µ—Ä–∞ –æ—Å—Ç–∞–ª–æ—Å—å:</div>
            <div class="countdown-grid">
              <div class="cd-item"><div class="cd-num" id="cd-days">0</div><div class="cd-lbl">–¥–Ω–µ–π</div></div>
              <div class="cd-item"><div class="cd-num" id="cd-hours">00</div><div class="cd-lbl">—á–∞—Å</div></div>
              <div class="cd-item"><div class="cd-num" id="cd-mins">00</div><div class="cd-lbl">–º–∏–Ω</div></div>
              <div class="cd-item"><div class="cd-num" id="cd-secs">00</div><div class="cd-lbl">—Å–µ–∫</div></div>
            </div>
          </div>

          <div class="nav-container">
            <button class="btn-nav rot180" data-prev>&#10140;</button>
            <button class="btn-nav" data-next>–õ–æ–∫–∞—Ü–∏—è &#10140;</button>
          </div>
        </div>
      </div>
      <div class="back"></div>
    </div>

    <!-- PAGE 6 -->
    <div class="page" id="p6">
      <div class="front">
        <div class="content-box">
          <h2>–õ–æ–∫–∞—Ü–∏—è</h2>
          <p>–ú—ã –±—É–¥–µ–º –∂–¥–∞—Ç—å —Ç–µ–±—è –∑–¥–µ—Å—å:</p>

          <div style="margin: 10px auto 12px; width: 210px; height: 170px; transform: rotate(-1.5deg); border: 4px solid #fff; box-shadow: 0 6px 14px rgba(0,0,0,0.22); overflow: hidden; border-radius: 12px;">
            <img src="photo.jpg" alt="–ú–µ—Å—Ç–æ" style="width:100%; height:100%; object-fit:cover;">
          </div>

          <a href="#" target="_blank" class="map-btn" id="mapBtn" rel="noopener">üìç –û—Ç–∫—Ä—ã—Ç—å –∫–∞—Ä—Ç—É</a>

          <p class="muted" style="margin-bottom:4px;">–ù–∞–∂–º–∏, —á—Ç–æ–±—ã –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç</p>
          <p class="muted" style="margin-top:0;">–í–æ–ø—Ä–æ—Å—ã: <strong id="contactTg">@your_contact</strong></p>

          <div class="nav-container">
            <button class="btn-nav rot180" data-prev>&#10140;</button>
            <button class="btn-nav" data-next>–§–æ—Ç–æ &#10140;</button>
          </div>
        </div>
      </div>
      <div class="back"></div>
    </div>

    <!-- PAGE 7 -->
    <div class="page" id="p7">
      <div class="front">
        <div class="content-box">
          <div class="icon-lg">üñºÔ∏è</div>
          <h2>–í–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏—è</h2>
          <p class="muted">–õ–∏—Å—Ç–∞–π —Ñ–æ—Ç–æ –≤–ø—Ä–∞–≤–æ ‚Äî —Å—Ç—Ä–∞–Ω–∏—Ü—ã –Ω–µ –ø–µ—Ä–µ–ª–∏—Å—Ç–Ω—É—Ç—Å—è.</p>

          <div class="gallery" id="photoGallery">
            <div class="polaroid">
              <img src="gallery1.jpg" alt="–§–æ—Ç–æ 1">
              <div class="photo-caption">–¢—ë–ø–ª—ã–π —Å–µ–º–µ–π–Ω—ã–π –º–æ–º–µ–Ω—Ç</div>
            </div>
            <div class="polaroid">
              <img src="gallery2.jpg" alt="–§–æ—Ç–æ 2">
              <div class="photo-caption">–ü—Ä–∞–∑–¥–Ω–∏–∫, –∫–æ—Ç–æ—Ä—ã–π –º—ã –ø–æ–º–Ω–∏–º</div>
            </div>
            <div class="polaroid">
              <img src="gallery3.jpg" alt="–§–æ—Ç–æ 3">
              <div class="photo-caption">–°—á–∞—Å—Ç—å–µ ‚Äî –≤ –ø—Ä–æ—Å—Ç—ã—Ö –≤–µ—â–∞—Ö</div>
            </div>
            <div class="polaroid">
              <img src="gallery4.jpg" alt="–§–æ—Ç–æ 4">
              <div class="photo-caption">–£–ª—ã–±–∫–∞, –∫–æ—Ç–æ—Ä–∞—è —Å–æ–≥—Ä–µ–≤–∞–µ—Ç</div>
            </div>
          </div>

          <div class="nav-container">
            <button class="btn-nav rot180" data-prev>&#10140;</button>
            <button class="btn-nav" data-next>–û—Ç–≤–µ—Ç &#10140;</button>
          </div>
        </div>
      </div>
      <div class="back"></div>
    </div>

    <!-- PAGE 8 -->
    <div class="page" id="p8">
      <div class="front">
        <div class="content-box">
          <div class="icon-lg">‚úâÔ∏è</div>
          <h2>–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ</h2>
          <p>–ë—É–¥–µ–º –±–ª–∞–≥–æ–¥–∞—Ä–Ω—ã –∑–∞ –æ—Ç–≤–µ—Ç –¥–æ <strong id="rsvpDeadline">10 —è–Ω–≤–∞—Ä—è</strong></p>

          <form id="rsvpForm" novalidate>
            <input type="text" id="company" name="company" autocomplete="off" tabindex="-1"
                   style="position:absolute; left:-9999px; opacity:0;" aria-hidden="true">
            <input type="text" id="name" placeholder="–ò–º—è –∏ –§–∞–º–∏–ª–∏—è" required>
            <select id="status">
              <option value="–ë—É–¥—É">–ë—É–¥—É</option>
              <option value="–ë—É–¥—É —Å –ø–∞—Ä–æ–π">–ë—É–¥—É —Å –ø–∞—Ä–æ–π</option>
              <option value="–ù–µ —Å–º–æ–≥—É">–ù–µ —Å–º–æ–≥—É</option>
            </select>

            <button type="submit" class="submit-btn" id="submitBtn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–≤–µ—Ç</button>
            <a class="tg-btn" id="tgFallback" href="#" target="_blank" rel="noopener" style="display:none;">–û—Ç–≤–µ—Ç–∏—Ç—å –≤ Telegram</a>
          </form>

          <div id="responseMessage" style="margin-top:10px;font-weight:bold;"></div>

          <div class="nav-container">
            <button class="btn-nav rot180" data-prev>&#10140;</button>
            <button class="btn-nav" id="skipBtn" style="opacity:.55; font-size:1rem;">–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å</button>
          </div>
        </div>
      </div>
      <div class="back"></div>
    </div>

  </div>

  <script>
    // ============================================================
    // –ù–ê–°–¢–†–û–ô–ö–ò
    // ============================================================
    const CONFIG = {
      celebrantName: "–Æ–±–∏–ª–µ–π –õ—é–¥–º–∏–ª—ã –ñ–∏–≤–∏—Ç—á–µ–Ω–∫–æ",
      eventDateISO: "2026-01-18T16:00:00",
      heroDateText: "18 —è–Ω–≤–∞—Ä—è",
      rsvpDeadlineText: "10 —è–Ω–≤–∞—Ä—è",

      mapUrl: "https://yandex.com/maps/-/CLgufJ~E",
      contactTg: "@Liudmila_Zhi",

      tgFallbackLink: "https://t.me/Liudmila_Zhi",

      // Google Apps Script Web App URL (–µ—Å–ª–∏ –ø–æ–∫–∞ –ø—É—Å—Ç–æ ‚Äî –ø–æ–∫–∞–∂–µ–º fallback –≤ Telegram)
      rsvpEndpoint: "https://script.google.com/macros/s/AKfycbyri2G_k6jHUdJ0frHNP7FzCOPs_NdMtWW6klNt1f_P9PJItFvOxgDkHxU9m7RtUlc2/exec",

      backCoverText: "–ë—É–¥–µ–º –æ—á–µ–Ω—å –∂–¥–∞—Ç—å"
    };

    // ============================================================
    // –í–°–¢–ê–í–ö–ê –î–ê–ù–ù–´–•
    // ============================================================
    document.getElementById("heroName").innerHTML = (CONFIG.celebrantName || "").replace(" ", "<br>");
    document.getElementById("heroDate").textContent = CONFIG.heroDateText;
    document.getElementById("rsvpDeadline").textContent = CONFIG.rsvpDeadlineText;
    document.getElementById("contactTg").textContent = CONFIG.contactTg;
    document.getElementById("mapBtn").href = CONFIG.mapUrl;
    document.getElementById("backCoverText").textContent = CONFIG.backCoverText;

    // ============================================================
    // –ö–ù–ò–ì–ê
    // ============================================================
    let current = 1;
    const pages = Array.from(document.querySelectorAll(".page"));
    const totalPages = pages.length;
    const getPage = (n) => document.getElementById("p" + n);

    pages.forEach((p, idx) => { p.style.zIndex = String(totalPages - idx); });

    function setBodyMode(){
      document.body.classList.toggle("opened", current >= 2);
    }

    function setActive(n){
      for(let i=1;i<=totalPages;i++){
        getPage(i).classList.remove("active-page","preactive");
      }
      const page = getPage(n);
      page.classList.add("active-page");
      current = n;
      setBodyMode();

      page.querySelectorAll("[data-typewriter]").forEach(typewriter);
    }

    function markPreactive(n){
      for(let i=1;i<=totalPages;i++) getPage(i).classList.remove("preactive");
      if(n>=1 && n<=totalPages) getPage(n).classList.add("preactive");
    }

    function markTurning(pageNums){
      pageNums.forEach(i => getPage(i).classList.add("turning"));
      setTimeout(() => pageNums.forEach(i => getPage(i).classList.remove("turning")), 980);

      const book = document.getElementById("book");
      const r = book.getBoundingClientRect();
      sparkleBurst(r.left + r.width * 0.76, r.top + r.height * 0.45, 14);
    }

    function flipTo(n){
      if(n < 1 || n > totalPages || n === current) return;
      if(document.body.classList.contains("back-closed")) return;

      const from = current;
      const to = n;
      const goingNext = to > from;

      markPreactive(to);

      if(goingNext){
        const nums = [];
        for(let i=from; i<to; i++) nums.push(i);
        markTurning(nums);
        for(let i=from; i<to; i++) getPage(i).classList.add("flipped");
      }else{
        const nums = [];
        for(let i=to; i<from; i++) nums.push(i);
        markTurning(nums);
        for(let i=to; i<from; i++) getPage(i).classList.remove("flipped");
      }

      setTimeout(() => setActive(to), 260);
    }

    function next(){
      if(current === totalPages){
        closeToBackCover();
      }else{
        flipTo(current + 1);
      }
    }
    function prev(){ flipTo(current - 1); }

    function closeToBackCover(){
      for(let i=1;i<=totalPages;i++){
        getPage(i).classList.remove("active-page","preactive");
      }
      document.body.classList.add("back-closed");
    }

    function restartFromBackCover(){
      document.body.classList.remove("back-closed");
      for(let i=1;i<=totalPages;i++){
        getPage(i).classList.remove("flipped","turning","preactive","active-page");
      }
      current = 1;
      setActive(1);
    }

    document.querySelectorAll("[data-next]").forEach(b => b.addEventListener("click", next));
    document.querySelectorAll("[data-prev]").forEach(b => b.addEventListener("click", prev));
    document.getElementById("skipBtn").addEventListener("click", (e)=>{ e.preventDefault(); closeToBackCover(); });
    document.getElementById("restartBtn").addEventListener("click", restartFromBackCover);

    document.getElementById("openBtn").addEventListener("click", async () => {
      flipTo(2);
      try{ await audio.play(); setMusicUI(true); }catch(e){}
    });

    // ============================================================
    // TYPEWRITER (–±–µ–∑ "–ø—Ä—ã–∂–∫–æ–≤" + –∞–≤—Ç–æ –±–µ–ª–∞—è –ø–æ–¥–ª–æ–∂–∫–∞ + fade-in)
    // ============================================================
    function typewriter(el){
      if(!el || el.dataset.twDone === "1") return;

      const original = (el.textContent || "").trim();
      const speed = Number(el.dataset.speed || 24);
      if(!original) return;

      // –∞–≤—Ç–æ –±–µ–ª–∞—è –ø–æ–¥–ª–æ–∂–∫–∞
      el.classList.add("tw-card");

      // —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è –≤—ã—Å–æ—Ç—ã: –∑–∞–º–µ—Ä—è–µ–º –≤—ã—Å–æ—Ç—É –ø–æ–ª–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞
      const prevVisibility = el.style.visibility;
      el.style.visibility = "hidden";
      el.textContent = original;
      const fullH = Math.ceil(el.getBoundingClientRect().height);
      el.textContent = "";
      el.style.minHeight = fullH + "px";
      el.style.visibility = prevVisibility || "";

      // –ø–ª–∞–≤–Ω–æ –ø—Ä–æ—è–≤–ª—è–µ–º –ø–æ–¥–ª–æ–∂–∫—É
      requestAnimationFrame(() => el.classList.add("is-visible"));

      el.dataset.twDone = "1";
      el.classList.add("tw");

      let i = 0;
      const tick = () => {
        i++;
        el.textContent = original.slice(0, i);

        const last = el.textContent.at(-1);
        const extra =
          last === "," ? 140 :
          (last === "." || last === "!" || last === "?" || last === "‚Ä¶") ? 260 :
          (last === "‚Äî") ? 180 :
          0;

        if(i < original.length){
          setTimeout(tick, speed + extra);
        }else{
          setTimeout(() => {
            el.classList.remove("tw");
            el.style.minHeight = "";
          }, 650);
        }
      };

      setTimeout(tick, 260);
    }

    // ============================================================
    // –¢–ê–ô–ú–ï–†
    // ============================================================
    const EVENT_DATE = new Date(CONFIG.eventDateISO);
    function updateTimer(){
      const now = new Date();
      const diff = EVENT_DATE - now;
      if(diff <= 0) return;

      const d = Math.floor(diff / (1000*60*60*24));
      const h = Math.floor((diff / (1000*60*60)) % 24);
      const m = Math.floor((diff / (1000*60)) % 60);
      const s = Math.floor((diff / 1000) % 60);

      const pad = (x) => String(x).padStart(2,"0");
      document.getElementById("cd-days").innerText = d;
      document.getElementById("cd-hours").innerText = pad(h);
      document.getElementById("cd-mins").innerText = pad(m);
      document.getElementById("cd-secs").innerText = pad(s);
    }
    setInterval(updateTimer, 1000);
    updateTimer();

    // ============================================================
// RSVP
// ============================================================
const rsvpForm = document.getElementById("rsvpForm");
const submitBtn = document.getElementById("submitBtn");
const responseMessage = document.getElementById("responseMessage");
const tgFallback = document.getElementById("tgFallback");
let lastSendAt = 0;

function showFallbackLink(text, name, status){
  const msg = encodeURIComponent(`–Æ–±–∏–ª–µ–π: ${name || ""}\n–û—Ç–≤–µ—Ç: ${status || ""}`);
  const base = CONFIG.tgFallbackLink;
  const url = base.includes("?") ? (base + "&text=" + msg) : (base + "?text=" + msg);

  tgFallback.style.display = "inline-block";
  tgFallback.href = url;
  tgFallback.textContent = text || "–û—Ç–≤–µ—Ç–∏—Ç—å –≤ Telegram";
}

rsvpForm.addEventListener("submit", async (e) => {
  e.preventDefault();

  const now = Date.now();
  if(now - lastSendAt < 6000) return;
  lastSendAt = now;

  const hp = document.getElementById("company")?.value?.trim();
  if(hp){
    responseMessage.textContent = "–°–ø–∞—Å–∏–±–æ! ‚ú®";
    responseMessage.style.color = "#2e7d32";
    setTimeout(closeToBackCover, 900);
    return;
  }

  const name = document.getElementById("name").value.trim();
  const status = document.getElementById("status").value;

  if(!name){
    responseMessage.textContent = "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏ –∏–º—è üôÇ";
    responseMessage.style.color = "#f44336";
    return;
  }

  submitBtn.disabled = true;
  submitBtn.textContent = "–û—Ç–ø—Ä–∞–≤–ª—è–µ–º‚Ä¶";
  submitBtn.style.background = "";
  tgFallback.style.display = "none";
  responseMessage.textContent = "–°–µ–∫—É–Ω–¥—É‚Ä¶";
  responseMessage.style.color = "#6e6e6e";

  if(!CONFIG.rsvpEndpoint){
    submitBtn.disabled = false;
    submitBtn.textContent = "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–≤–µ—Ç";
    responseMessage.textContent = "–§–æ—Ä–º–∞ –µ—â—ë –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∞ ‚Äî –º–æ–∂–Ω–æ –æ—Ç–≤–µ—Ç–∏—Ç—å –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä—É –≤ Telegram.";
    responseMessage.style.color = "#b07b12";
    showFallbackLink("–û—Ç–≤–µ—Ç–∏—Ç—å –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä—É", name, status);
    return;
  }

  try{
    const payload = { name, status, ts: new Date().toISOString() };

    await fetch(CONFIG.rsvpEndpoint, {
      method: "POST",
      mode: "no-cors",
      headers: { "Content-Type": "text/plain;charset=utf-8" },
      body: JSON.stringify(payload)
    });

    // –í no-cors –æ—Ç–≤–µ—Ç opaque, –µ–≥–æ –Ω–µ–ª—å–∑—è –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á–µ—Ä–µ–∑ res.ok ‚Äî —Å—á–∏—Ç–∞–µ–º —É—Å–ø–µ—Ö–æ–º,
    // –µ—Å–ª–∏ –∑–∞–ø—Ä–æ—Å –Ω–µ —É–ø–∞–ª —Å –æ—à–∏–±–∫–æ–π —Å–µ—Ç–∏.
    submitBtn.disabled = true;
    submitBtn.textContent = "‚úÖ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ";
    submitBtn.style.background = "#2e7d32";
    responseMessage.textContent = "–ì–æ—Ç–æ–≤–æ! –ú—ã –ø–æ–ª—É—á–∏–ª–∏ —Ç–≤–æ–π –æ—Ç–≤–µ—Ç ‚ú®";
    responseMessage.style.color = "#2e7d32";
    setTimeout(closeToBackCover, 1200);

  } catch(err){
    console.error("RSVP error:", err);

    submitBtn.disabled = false;
    submitBtn.textContent = "–ü–æ–≤—Ç–æ—Ä–∏—Ç—å";
    submitBtn.style.background = "#f44336";
    responseMessage.textContent = "–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å. –ù–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ –∏ –æ—Ç–≤–µ—Ç—å –≤ Telegram.";
    responseMessage.style.color = "#f44336";
    showFallbackLink("–û—Ç–≤–µ—Ç–∏—Ç—å –≤ Telegram", name, status);
  }
});


    // ============================================================
    // –ú–£–ó–´–ö–ê
    // ============================================================
    const musicBtn = document.getElementById("musicBtn");
    const audio = document.getElementById("bg-music");

    function setMusicUI(playing){
      if(playing) musicBtn.classList.add("is-playing");
      else musicBtn.classList.remove("is-playing");
    }

    musicBtn.addEventListener("click", async () => {
      try{
        if(audio.paused){
          await audio.play();
          setMusicUI(true);
        }else{
          audio.pause();
          setMusicUI(false);
        }
      }catch(e){}
    });

    // ============================================================
    // –°–í–ê–ô–ü –ü–û –°–¢–†–ê–ù–ò–¶–ê–ú (–∏ –∑–∞—â–∏—Ç–∞ –æ—Ç –ø–µ—Ä–µ–ª–∏—Å—Ç—ã–≤–∞–Ω–∏—è –ø—Ä–∏ —Å–≤–∞–π–ø–µ –≥–∞–ª–µ—Ä–µ–∏)
    // ============================================================
    let startX=0, startY=0, swipingGallery=false;

    function isInGallery(e){
      const t = e.target;
      if(t && t.closest && t.closest(".gallery")) return true;
      if(e.composedPath){
        return e.composedPath().some(n => n && n.classList && n.classList.contains("gallery"));
      }
      return false;
    }

    document.addEventListener("touchstart", (e) => {
      const t = e.changedTouches[0];
      startX = t.screenX;
      startY = t.screenY;
      swipingGallery = isInGallery(e);
    }, { passive: true });

    document.addEventListener("touchend", (e) => {
      if(document.body.classList.contains("back-closed")) return;
      if (swipingGallery) return;

      const target = e.target;
      if (target.tagName === "INPUT" || target.tagName === "BUTTON" || target.tagName === "SELECT" || (target.closest && target.closest("a"))) return;

      const t = e.changedTouches[0];
      const dx = t.screenX - startX;
      const dy = t.screenY - startY;

      if(Math.abs(dy) > Math.abs(dx)) return;
      if(dx < -60) next();
      if(dx > 60) prev();
    }, { passive: true });

    window.addEventListener("keydown", (e) => {
      if(document.body.classList.contains("back-closed")) return;
      if(e.key === "ArrowRight") next();
      if(e.key === "ArrowLeft") prev();
    });

    // ============================================================
    // –ì–ê–õ–ï–†–ï–Ø: drag-to-scroll (—Å—Ç–∞–±–∏–ª—å–Ω–æ –≤–µ–∑–¥–µ)
    // ============================================================
    (function enableGalleryDrag(){
      const g = document.getElementById("photoGallery");
      if(!g) return;

      let isDown = false;
      let startClientX = 0;
      let startScrollLeft = 0;

      const onDown = (e) => {
        if(e.pointerType === "mouse" && e.button !== 0) return;
        isDown = true;
        startClientX = e.clientX;
        startScrollLeft = g.scrollLeft;
        try{ g.setPointerCapture(e.pointerId); }catch(_){}
        e.stopPropagation();
      };

      const onMove = (e) => {
        if(!isDown) return;
        const dx = e.clientX - startClientX;
        g.scrollLeft = startScrollLeft - dx;
        e.stopPropagation();
      };

      const onUp = (e) => {
        isDown = false;
        e.stopPropagation();
      };

      g.addEventListener("pointerdown", onDown, { passive: true });
      g.addEventListener("pointermove", onMove, { passive: true });
      g.addEventListener("pointerup", onUp, { passive: true });
      g.addEventListener("pointercancel", onUp, { passive: true });
    })();

    // ============================================================
    // FX CANVAS: —Å–Ω–µ–≥ + –∑–æ–ª–æ—Ç–æ + –≤—Å–ø—ã—à–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ–ª–∏—Å—Ç—ã–≤–∞–Ω–∏–∏
    // ============================================================
    const canvas = document.getElementById("fx");
    const ctx = canvas.getContext("2d", { alpha:true });

    const reduceMotion = window.matchMedia && window.matchMedia("(prefers-reduced-motion: reduce)").matches;

    let W=0,H=0,DPR=1;
    const snow=[], motes=[], sparks=[];

    function resize(){
      DPR = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
      W = Math.floor(window.innerWidth);
      H = Math.floor(window.innerHeight);

      canvas.width = Math.floor(W*DPR);
      canvas.height = Math.floor(H*DPR);
      canvas.style.width = W+"px";
      canvas.style.height = H+"px";
      ctx.setTransform(DPR,0,0,DPR,0,0);

      snow.length=0; motes.length=0;

      const snowCount = Math.round(Math.min(140, Math.max(80, W/7)));
      const moteCount = 28;

      for(let i=0;i<snowCount;i++){
        snow.push({
          x: Math.random()*W,
          y: Math.random()*H,
          r: Math.random()*1.7 + 0.55,
          vy: Math.random()*0.85 + 0.30,
          vx: (Math.random()-0.5)*0.18,
          phase: Math.random()*Math.PI*2,
          omega: Math.random()*0.02 + 0.008,
          alpha: Math.random()*0.26 + 0.14
        });
      }
      for(let i=0;i<moteCount;i++){
        motes.push({
          x: Math.random()*W,
          y: Math.random()*H,
          r: Math.random()*2.4 + 1.1,
          vy: (Math.random()-0.5)*0.15,
          vx: (Math.random()-0.5)*0.15,
          alpha: Math.random()*0.18 + 0.10
        });
      }
    }

    function sparkleBurst(x,y,count=14){
      if(reduceMotion) return;
      const n = Math.max(6, Math.min(24, count));
      for(let i=0;i<n;i++){
        const a = Math.random()*Math.PI*2;
        const sp = Math.random()*1.6 + 0.7;
        sparks.push({
          x, y,
          vx: Math.cos(a)*sp,
          vy: Math.sin(a)*sp - 0.35,
          r: Math.random()*1.6 + 0.8,
          life: 1,
          decay: Math.random()*0.028 + 0.018
        });
      }
    }

    function draw(){
      ctx.clearRect(0,0,W,H);

      for(const p of motes){
        p.x += p.vx; p.y += p.vy;
        if(p.x < -10) p.x = W+10;
        if(p.x > W+10) p.x = -10;
        if(p.y < -10) p.y = H+10;
        if(p.y > H+10) p.y = -10;

        ctx.beginPath();
        ctx.fillStyle = `rgba(197,160,89,${p.alpha})`;
        ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
        ctx.fill();
      }

      for(let i=sparks.length-1;i>=0;i--){
        const s = sparks[i];
        s.life -= s.decay;
        s.vy += 0.02;
        s.x += s.vx;
        s.y += s.vy;

        const a = Math.max(0, s.life);
        ctx.beginPath();
        ctx.fillStyle = `rgba(252,246,186,${a*0.75})`;
        ctx.arc(s.x,s.y,s.r,0,Math.PI*2);
        ctx.fill();

        ctx.beginPath();
        ctx.fillStyle = `rgba(197,160,89,${a*0.55})`;
        ctx.arc(s.x - s.r*0.25, s.y - s.r*0.25, s.r*0.6, 0, Math.PI*2);
        ctx.fill();

        if(s.life <= 0) sparks.splice(i,1);
      }

      for(const f of snow){
        f.phase += f.omega;
        f.y += f.vy;
        f.x += Math.sin(f.phase)*0.34 + f.vx;

        if(f.y > H+10){ f.y = -10; f.x = Math.random()*W; }
        if(f.x < -10) f.x = W+10;
        if(f.x > W+10) f.x = -10;

        ctx.beginPath();
        ctx.fillStyle = `rgba(255,255,255,${f.alpha})`;
        ctx.arc(f.x,f.y,f.r,0,Math.PI*2);
        ctx.fill();

        ctx.beginPath();
        ctx.fillStyle = `rgba(252,246,186,${Math.max(0,f.alpha-0.10)})`;
        ctx.arc(f.x - f.r*0.25, f.y - f.r*0.25, f.r*0.45, 0, Math.PI*2);
        ctx.fill();
      }

      requestAnimationFrame(draw);
    }

    window.addEventListener("resize", resize, { passive:true });
    resize();
    if(!reduceMotion) requestAnimationFrame(draw);

    // ============================================================
    // INIT
    // ============================================================
    setActive(1);
    setBodyMode();
  </script>
</body>
</html>
